# 网络基础

TCP/IP 是传输控制协议/网络互联协议
MAC地址由48位二进制组成，通常分为6段，用十六进制表示
IP地址由4个字节组成

A类 1~126  一个网络位，加上三个主机位组成
B类 128~191 两个网络位，加上两个主机位
C类 192~223 三个网络位，加上一个主机位

## OSI七层模型

应用层（Application）提供网络与用户应用软件之间的接口服务（HTTP）(消息)
表示层（Presentation）提供格式化的表示和转换数据服务，如加密和压缩 
会话层（Session）提供包括访问验证和会话管理在内的建立和维护应用之间通信的机制
传输层（Transmission）提供建立、维护和取消传输连接功能，负责可靠的传输数据（TCP）(段)
网络层（Network）处理网络间路由，确保数据及时传送（路由器）(数据包)
数据链路层（DataLink）建立逻辑链接，负责无差错的传输数据，确认帧、发错重传等（交换机）(数据帧)
物理层（Physis）提供机械、电气、功能和过程特征（网卡、网线、双绞线、同轴电缆、中继器）

## TCP/IP模型

应用层：(HTTP, FTP, TFTP, SMTP, SNMP, DNS)
传输层：(TCP, UDP)
网络层：(ICMP, IGMP, IP, ARP, RARP)
数据链路层：
物理层：

ARP协议：地址解析协议，即ARP，是根据IP地址获取物理地址的一个TCP/IP协议

## UDP TCP
UDP就面向报文，TCP面向字节流
UDP是不可靠链接， TCP是可靠连接


## TCP\IP报文格式

1序号: Seq序号，占32位，用来标识从TCP源端向目的端发送的字节流，发起方发送数据时对此进行标记
2确认序号：Ack序号，占32位，只有ACK标志位为1时，确认序号字段才有效，ACK=Seq+1
3标志位：共6个，即URG,ACK,PSH,RST,SYN,FIN等，具体含义如下
(A)URG:紧急指针（Urgent pointer）有效
(B)ACK:确认序列号有效
(C)PSH:接收方应该尽快将这个报文交给应用层
(D)RST:重置连接
(E)SYN:发起一个新连接
(F)FIN:释放一个连接

## TCP 三次握手

所谓三次握手，指的建立一个TCP连接时，需要客户端和服务器总共发送三个包
三次握手的目的是连接服务器指定端口，建立TCP连接，并同步连接双方的序列号和确认号交换TCP窗口大小信息。在socket编程中，客户端执行connect()时。将触发三次握手

【第一次握手】客户端要向服务端发起连接请求，首先客户端随机生成一个起始序列号ISN(比如是100)，那客户端向服务端发送的报文端包括SYN和ACK标志(也就是SYN=1),序列号seq=100

【第二次握手】服务端收到客户端发送过来的报文后，发现SYN=1，知道这是一个连接请求，于是将客户端的起始序列号100存起来，并且随机生成一个服务的起始序列号（比如300）。然后，给客户端回复一段报文，回复报文包含SYN和ACK标志（也就是SYN=1, ACK=1）,序列号seq=300,确认号ack=101（客户端发过来的序列号+1）

【第三次握手】客户端收到服务端的回复后发现ACK=1并且ack=101,于是知道服务端已经收到了序列号为100的那段报文；同时发现SYN=1，知道了服务端同意了这次连接，于是就将服务端的序列号300给存下来。然后客户端再回复一段报文给服务端，报文包含ACK标志位(ACK=1)、ack=301(服务端序列号+1)、seq=101(第一次握手时发送报文是占据一个序列号的，所以这次seq就从101开始，需要注意的是不携带数据的ACK报文是不占据序列号的，所以后面第一次正式发送数据时seq还是101)。当服务端收到报文后发现ACK=1并且ack=301，就知道客户端收到序列号为300的报文了，就这样客户端和服务端通过TCP建立了连接。

## TCP 四次挥手
第一次挥手：客户端发送一个 FIN 报文，报文中会指定一个序列号。此时客户端处于 FIN_WAIT1 状态。

即发出连接释放报文段（FIN=1，序号seq=u），并停止再发送数据，主动关闭TCP连接，进入FIN_WAIT1（终止等待1）状态，等待服务端的确认。

第二次挥手：服务端收到 FIN 之后，会发送 ACK 报文，且把客户端的序列号值 +1 作为 ACK 报文的序列号值，表明已经收到客户端的报文了，此时服务端处于 CLOSE_WAIT 状态。

即服务端收到连接释放报文段后即发出确认报文段（ACK=1，确认号ack=u+1，序号seq=v），服务端进入CLOSE_WAIT（关闭等待）状态，此时的TCP处于半关闭状态，客户端到服务端的连接释放。客户端收到服务端的确认后，进入FIN_WAIT2（终止等待2）状态，等待服务端发出的连接释放报文段。

第三次挥手：如果服务端也想断开连接了，和客户端的第一次挥手一样，发给 FIN 报文，且指定一个序列号。此时服务端处于 LAST_ACK 的状态。

即服务端没有要向客户端发出的数据，服务端发出连接释放报文段（FIN=1，ACK=1，序号seq=w，确认号ack=u+1），服务端进入LAST_ACK（最后确认）状态，等待客户端的确认。

第四次挥手：客户端收到 FIN 之后，一样发送一个 ACK 报文作为应答，且把服务端的序列号值 +1 作为自己 ACK 报文的序列号值，此时客户端处于 TIME_WAIT 状态。需要过一阵子以确保服务端收到自己的 ACK 报文之后才会进入 CLOSED 状态，服务端收到 ACK 报文之后，就处于关闭连接了，处于 CLOSED 状态。

## 正向代理与反向代理

如果代理服务器是帮助客户端的，就是正向代理 
帮助服务器的就是反向代理
正向代理 可以在请求的时候增加一些属性，权限认证，nginx缓存

正向代理的用途
1.访问原来无法访问的资源，如Google
2.可以作缓存，加速访问资源
3.对客户端访问授权，上网进行认证
4.代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息

反向代理的用途
1.保证内网的安全，通常将反向代理作为公网访问地址，web服务器是内网
2.负载均衡，通过反向代理服务器来优化网站的负载

## CDN 服务如何实现网络加速
在传统网站访问过程中生成N多个原网站镜像，并分别储存在不同的地区，不同线路的缓存服务器上，并在用户访问网站时做出一定的就近，负载最轻，利于用户最快访问网站路线判断，然后做出响应，这样就在用户地区、网络线路多样性的情况下，保证所有地区及网络线路都以同样的最快速度访问网站。

## 什么是代理？什么是网关？代理和网关的作用是什么？

## HTTPS 相比 HTTP 为什么更加安全可靠？
1、https协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。
2、http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。
3、http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。
4、http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。

## TCP/IP 协议簇
应用层：TFTP，HTTP，SNMP，FTP，SMTP(简单邮件传输协议)，DNS，Telnet 等等
传输层：TCP（传输控制协议），UDP（用户数据报协议）
网络层：IP(网际协议)，ICMP（网络控制消息协议），OSPF，EIGRP，IGMP
数据链路层：SLIP，CSLIP，PPP，MTU, ARP, RARP